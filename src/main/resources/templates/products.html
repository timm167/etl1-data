<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Products</title>
    <link rel="stylesheet" th:href="@{/css/navbar.css}" href="/navbar.css">

</head>
<body>
<!-- Basket button at top right -->
<div style="text-align: right; margin: 10px;">
    <a href="/basket" style="background: #007bff; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px;">
        ðŸ›’ View Basket
    </a>
</div>
  
<div th:replace="navbar :: navbar"></div>

<form th:action="@{/products}" method="get">
    <p>
        <label for="sortBy">Sort By</label>
        <select th:value="${sortBy}" name="sortBy" id="sortBy" size="1">
            <option>Name</option>
            <option>Price</option>
        </select>
        <select th:value="${order}" name="order" id="order" size="1">
            <option>Ascending</option>
            <option>Descending</option>
        </select>
    </p>
    <p>
        <label for="filterBy">Filter</label>
        <select th:value="${filterBy}" name="filterBy" id="filterBy" size="1" onchange="checkFilterBy(this);">
            <option>(No filter)</option>
            <option>Price</option>
            <option>CPU clock speed</option>
            <option>GPU clock speed</option>
        </select>
        <select th:value="${filterOp}" name="filterOp" id="filterOp" size="1">
            <option>at least</option>
            <option>at most</option>
        </select>
        <label id="priceFilterLabel" for="numberFilter">Â£</label>
        <input type="number" th:value="${numberFilter}" name="numberFilter" id="numberFilter" step="any">
        <label id="cpuClockFilterLabel" for="numberFilter">GHz</label>
        <label id="gpuClockFilterLabel" for="numberFilter">MHz</label>
    </p>
    <p>
        <button type="submit">Go</button>
    </p>
</form>
<ul>
    <li th:each="product : ${products}" th:if="${product.price > 0.0}">
        <h2 th:text="${product.name}">Product Name</h2>

        <p th:text="'Cost: Â£' + ${product.cost}"></p>
        <p th:text="'Price: Â£' + ${product.price}"></p>

        <p th:text="'Color: ' + (${product.color != null ? product.color.hex : 'N/A'})"></p>
        <p th:text="'Case: ' + (${product.caseEntity != null ? product.caseEntity.name : 'N/A'})"></p>
        <p th:text="'CPU: ' + (${product.cpu != null ? product.cpu.name : 'N/A'})"></p>
        <p th:text="'CPU Cooler: ' + (${product.cpuCooler != null ? product.cpuCooler.name : 'N/A'})"></p>
        <p th:text="'Graphics Card: ' + (${product.graphicsCard != null ? product.graphicsCard.name : 'N/A'})"></p>
        <p th:text="'Internal Storage: ' + (${product.internalStorage != null ? product.internalStorage.name : 'N/A'})"></p>
        <p th:text="'Memory: ' + (${product.memory != null ? product.memory.name : 'N/A'})"></p>
        <p th:text="'Motherboard: ' + (${product.motherboard != null ? product.motherboard.name : 'N/A'})"></p>
        <p th:text="'Power Supply: ' + (${product.powerSupply != null ? product.powerSupply.name : 'N/A'})"></p>

        <!-- Reviews section -->
        <div class="reviews">
            <h3>Reviews</h3>

            <!-- Optional display if you provide a Map<Integer, List<Review>> named 'reviewsByProductId' -->
            <div th:if="${reviewsByProductId != null}">
                <ul>
                    <li th:if="${#lists.isEmpty(reviewsByProductId[product.id])}">No reviews yet.</li>
                    <li th:each="r : ${reviewsByProductId[product.id]}">
                        <strong th:text="${r.email}">email</strong>:
                        <span th:text="${r.content}">content</span>
                        <small th:text="${#temporals.format(r.createdAt, 'yyyy-MM-dd HH:mm')}"></small>
                    </li>
                </ul>
            </div>

            <h4>Add a review</h4>
            <form th:action="@{/products/{id}/reviews(id=${product.id})}" method="post">
                <label>
                    Review
                    <textarea name="content" rows="3" cols="40" required></textarea>
                </label>
                <br>
                <button type="submit">Submit</button>
            </form>
        </div>
    </li>
</ul>
</body>

<script>

    document.addEventListener('DOMContentLoaded', () => {
        const toggleButton = document.querySelector('.dropdown-toggle');
        const dropdown = document.getElementById('componentsDropdown');

        toggleButton.addEventListener('click', () => {
            const isVisible = dropdown.style.display === 'block';
            dropdown.style.display = isVisible ? 'none' : 'block';
        });

        window.addEventListener('click', (event) => {
            if (!toggleButton.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });
    });

</script>
<script th:src="@{/js/filterDisplay.js}"></script>
</html>