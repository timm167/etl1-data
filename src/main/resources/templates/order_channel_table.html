<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Channels - PC Store</title>

  <!-- CSS Files -->
  <link rel="stylesheet" th:href="@{/css/main.css}">
  <link rel="stylesheet" th:href="@{/css/navbar.css}">
  <link rel="stylesheet" th:href="@{/css/order_table.css}">
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div id="confirm-modal" class="modal">
    <div class="modal-content">
        <h2>Mark as delivered?</h2>
        <p>Are you sure you want to mark this order as delivered?</p>
        <div class="modal-actions">
            <button id="confirm-yes" class="btn btn-primary">Yes</button>
            <button id="confirm-no" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>

<div class="table-container">
  <h1>ðŸšš Order Distribution Channels</h1>

  <div style="text-align: center; margin-bottom: var(--spacing-xl);">
    <p style="color: var(--text-gray); font-size: var(--font-size-lg);">
      Track orders through the distribution network
    </p>
  </div>

<table>
  <thead>
  <tr>
    <th>Order ID</th>
    <th>Product</th>
      <th>Quantity</th>
    <th>Warehouse</th>
    <th>Distribution Facility</th>
    <th>Start Shipper</th>
    <th>End Shipper</th>
      <th>Recipient</th>
      <th>Delivery Address</th>
    <th>Order Status</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="order : ${orders}">
      <td>
          <strong style="color: var(--primary-orange);" th:text="${order.id}">#001</strong>
      </td>
      <td th:text="${order.product.name}">Product Name</td>
      <td th:text="${order.quantity}">Quantity</td>
    <td th:text="${order.distributionChannel.warehouse.locationName}">Warehouse</td>
    <td th:text="${order.distributionChannel.distributionFacility.locationName}">Facility</td>
    <td>
      <a th:href="@{/shipper/{id}(id=${order.distributionChannel.startShipper.id})}"
         th:text="${order.distributionChannel.startShipper.facility_name}">
        Start Shipper
      </a>
    </td>
    <td>
      <a th:href="@{/shipper/{id}(id=${order.distributionChannel.endShipper.id})}"
         th:text="${order.distributionChannel.endShipper.facility_name}">
        End Shipper
      </a>
    </td>
      <td th:text="${order.recipient}"></td>

      <td th:text="${order.address}">Facility</td>
      <td>
        <span th:text="${order.isOpen} ? 'Open' : 'Closed'"
              th:class="'order-status ' + (${order.isOpen} ? 'clickable status-pending' : 'status-delivered')"
              th:attr="data-order-id=${order.id}">
            Status
        </span>

          <form th:action="@{/orders/mark-delivered}" method="post" class="deliver-form" style="display:none;">
              <input type="hidden" name="orderId" th:value="${order.id}">
          </form>
      </td>


  </tr>

  <!-- Sample data rows if no orders exist -->
  <tr th:if="${#lists.isEmpty(orders)}">
      <td colspan="7" class="empty-table">
          <div class="empty-table-icon">ðŸ“¦</div>
          <h3>No Orders in Distribution</h3>
          <p>There are currently no orders being tracked through the distribution network.</p>
      </td>
  </tr>

  <!-- Sample static rows for demonstration if orders list is empty -->
  <tr th:if="${orders == null or #lists.isEmpty(orders)}">
      <td><strong style="color: var(--primary-orange);">#001</strong></td>
      <td>Gaming PC Build - RTX 4090</td>
      <td><span class="status-pending">Open</span></td>
      <td>Main Warehouse</td>
      <td>Central Distribution Hub</td>
      <td>FedEx Ground</td>
      <td>Local Courier Service</td>
  </tr>
  <tr th:if="${orders == null or #lists.isEmpty(orders)}">
      <td><strong style="color: var(--primary-orange);">#002</strong></td>
      <td>Custom Workstation - Threadripper</td>
      <td><span class="status-delivered">Closed</span></td>
      <td>Secondary Warehouse</td>
      <td>Regional Distribution Center</td>
      <td>UPS Express</td>
      <td>DHL Last Mile</td>
  </tr>
  <tr th:if="${orders == null or #lists.isEmpty(orders)}">
      <td><strong style="color: var(--primary-orange);">#003</strong></td>
      <td>RGB Memory Kit - 32GB DDR5</td>
      <td><span class="status-pending">Open</span></td>
      <td>Main Warehouse</td>
      <td>Express Distribution Hub</td>
      <td>DHL International</td>
      <td>Amazon Logistics</td>
  </tr>
  </tbody>
</table>
</div>
</body>

<script>
    // Add some basic interactivity
    document.addEventListener('DOMContentLoaded', function() {
        // Add hover effects to table rows
        const rows = document.querySelectorAll('tbody tr');
        rows.forEach(row => {
            row.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
            });

            row.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Add click to highlight functionality
        rows.forEach(row => {
            row.addEventListener('click', function() {
                // Remove highlight from other rows
                rows.forEach(r => r.classList.remove('highlighted'));
                // Add highlight to clicked row
                this.classList.add('highlighted');
            });
        });

        const modal = document.getElementById("confirm-modal");
        const yesBtn = document.getElementById("confirm-yes");
        const noBtn = document.getElementById("confirm-no");
        let pendingForm = null;

        document.querySelectorAll(".order-status.clickable").forEach(el => {
            el.addEventListener("click", e => {
                e.stopPropagation();
                pendingForm = el.closest("td").querySelector(".deliver-form");
                modal.style.display = "flex";
            });
        });

        yesBtn.addEventListener("click", () => {
            if (pendingForm) pendingForm.submit();
            modal.style.display = "none";
            pendingForm = null;
        });

        noBtn.addEventListener("click", () => {
            modal.style.display = "none";
            pendingForm = null;
        });

        // Close if clicking outside modal content
        modal.addEventListener("click", e => {
            if (e.target === modal) {
                modal.style.display = "none";
                pendingForm = null;
            }
        });
    });

</script>
<style>
    /* Additional styles for this specific page */
    .highlighted {
        background-color: rgba(254, 119, 67, 0.15) !important;
        box-shadow: 0 0 0 2px var(--primary-orange);
    }

    .empty-table {
        text-align: center !important;
        padding: var(--spacing-2xl) !important;
    }

    /* Enhanced status styling for this page */
    .status-pending {
        background: linear-gradient(45deg, var(--warning-yellow), #FBBF24);
        color: var(--white);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
        font-weight: 600;
        font-size: var(--font-size-xs);
        text-transform: uppercase;
        transition: all 0.2s ease-in-out;
        cursor: pointer;
    }

    .status-pending:hover {
        background: linear-gradient(45deg, #FFD54F, #FACC15); /* brighter yellow */
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        transform: translateY(-2px);
    }

    .status-delivered {
        background: linear-gradient(45deg, var(--success-green), #34D399);
        color: var(--white);
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-sm);
        font-weight: 600;
        font-size: var(--font-size-xs);
        text-transform: uppercase;
        transition: all 0.2s ease-in-out;
    }


    .modal {
        display: none; /* hidden by default */
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: #fff;
        border-radius: 12px;
        padding: 2rem;
        max-width: 400px;
        text-align: center;
        box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    .modal-actions {
        margin-top: 1.5rem;
        display: flex;
        gap: 1rem;
        justify-content: center;
    }

    .modal .btn {
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
    }

    .btn-primary {
        background: var(--primary-orange, #f97316);
        color: #fff;
    }

    .btn-primary:hover {
        background: #fb923c;
    }

    .btn-secondary {
        background: #e5e7eb;
        color: #111;
    }

    .btn-secondary:hover {
        background: #d1d5db;
    }


</style>

</html>